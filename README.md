# algyan_8th

IoT ALGYAN 8周年 オリジナルIoTデバイスのリポジトリです。

ご質問、ご意見は、GitHub Discussionsへ。お気軽にどうぞ。

## タイムライン

1. (-12/E)どんなデバイスを作るか考える
2. (-2/M)1st基板（ES）を作って機能とコスト感を確認する
3. (-2/E)2nd基板（ES2）を製造する **←イマココ**
4. (-3/M)2nd基板（ES2）を動作確認する
5. (-3/E)配布基板を製造する
6. (-3/E)ソフトを作る
7. (?)IoT ALGYAN 8周年イベントやる

## コンセプト

**"IoTをやってみたい人から、バリバリのベテランにも楽しんでもらえるIoTデバイスを目指す"**

* デバイス、ファームウェア、クラウドの全てにおいて、完成品（クラウドはお試しする場所）を提供するとともに、全ての範囲でカスタマイズ可能にする
   * 完成品デバイスはどうやって入手可能にするかなぁ
   * クラウドは期間を限定（たとえば、IoT ALGYANでイベントのときとか）すれば提供できそう
* 入手しやすい部品を使う（難しい...）
* 部品代は3000円以内にしたい（これも難しい...）
* 開発PCはWindows, macOS, Linux

## どんなデバイスにしよう？

* LEDマトリックスで、かっこいいパターンを表示するデバイス。こんなイメージ。https://www.youtube.com/watch?v=y8m3hBudrTc
* 操作の自由度を上げるために、ロータリーエンコーダーを追加。
* ベテランが楽しめるように、スピーカーを追加。
* もちろん、Azure IoTに接続可能。
* 持ち歩きできるように小型でバッテリーor乾電池駆動としたいが、これは将来バージョンで対応か。

### 構成

```mermaid
flowchart LR
    id1[LEDマトリックス]-- x16 DO ---id7[LEDドライバ]
    id7-- x2 DO ---id2[マイコン]
    id3[スピーカー]---id11[パワーアンプ]
    id11-- x1 PWM ---id2
    id4[ロータリーエンコーダー]-- x2 DI ---id2
    id8[x1 LED]-- x1 DO ---id2
    id9[x2 ボタン]-- x2 DI ---id2
    id2-- Wi-Fi ---id6[Azure IoT]
    id10[Grove I2C]-- I2C ---id2
```

* LEDは、マイコン動作状態の表示
* ボタンは、確定とキャンセルの操作

### 部品リスト

| 部品名 | 数量 | 製品名 | 単価 | 部品コード | 在庫グレード | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **マイコン** | 1 | Ｓｅｅｅｄ　Ｓｔｕｄｉｏ　ＸＩＡＯ　ＥＳＰ３２Ｃ３ | 940 | M-17454 | AAA | |
| LEDマトリックス | 1 | 黄色ドットマトリクスＬＥＤ　８×８ドット　ＯＳＬ６４１５０１－ＡＹ | 150 | I-07662 | AAA | 38x38mm、Vf=2.1V |
| LEDマトリックス | 1 | 赤色ドットマトリクスＬＥＤ　８×８ドット　ＯＳＬ６４１５０１－ＡＲＡ | 200 | I-05163 | AAA | 38x38mm、Vf=2.1V |
| LEDマトリックス | 1 | 緑色ドットマトリクスＬＥＤ　８×８ドット　ＯＳＬ６４１５０１－ＡＧ | 250 | I-07661 | AAA | 38x38mm、Vf=3.3V |
| LEDマトリックス | 1 | 青色ドットマトリクスＬＥＤ　８×８ドット　ＯＳＬ６４１５０１－ＡＢ | 300 | I-07660 | AAA | 38x38mm、Vf=3.3V |
| **LEDマトリックス** | 1 | ２色ドットマトリクスＬＥＤ（赤緑）　８×８ドット　ＬＴＰ－１２１８８Ｍ－０８ | 140 | I-09878 | AAA | 32x32mm、Vf=2.1V |
| **LEDドライバ** | 1 | ７セグメント用ＬＥＤドライバーＩＣ（最大１６個）　ＴＭ１６４０ | 80 | I-13225 | D,AAA | 5V |
| LEDドライバ | 1 | １６×８ＬＥＤマトリクスドライバー　キースキャン機能付　ＨＴ１６Ｋ３３ | 120 | I-15330 | AAA | 5V、**在庫切れ** |
| スピーカー | 1 | マイクロスピーカー　赤／黒リード付　８Ω | 50 | P-12494 | S,AAA | 23x16mm |
| **スピーカー** | 1 | 基板取付用スピーカーユニット　８Ω０．０８Ｗ　ＵＧＳＭ２３Ａ | 100 | P-09797 | AAA | φ23mm |
| パワーアンプ | 1 | 低電圧動作パワーアンプ　ＮＪＭ２１１３Ｍ | 50 | I-10981 | D,A | |
| **パワーアンプ** | 1 | 低電圧動作パワーアンプ　ＮＪＭ２１１３Ｄ | 60 | I-11192 | AAA | |
| ロータリーエンコーダー | 1 | ロータリーエンコーダ（２４クリックタイプ） | 80 | P-06357 | A | |
| ロータリーエンコーダー | 1 | ロータリーエンコーダ（ノンクリックタイプ） | 90 | P-06358 | AAA | |
| ロータリーエンコーダー | 1 | 	ロータリーエンコーダ | 200 | P-00292 | AAA | フットプリントが他と違う |
| **ロータリーエンコーダー** | 1 | ＬＥＤ付ロータリーエンコーダ（赤）ツマミ付セット | 220 | P-05762 | AAA | |
| ロータリーエンコーダー | 1 | 表面実装用ロータリーエンコーダー　センタープッシュ付き | 200 | P-14936 | AAA | |
| （単四電池BOX） | 1 | 電池ボックス　単４×２本　リード線・フタ・スイッチ付 | 110 | P-00348 | AA | フタ付、スイッチ付、コネクタ無 |
| （昇圧DCDC）| 1 | ＸＣＬ１０３使用３．３Ｖ出力昇圧ＤＣＤＣコンバーターキット | 300 | K-16116 | AAA | 3.3V出力、0.25A |

### マイコンI/Oマップ

| ピン番号 | XIAO ESP32C3 | XIAO BLE | 接続部品 |
| :--- | :--- | :--- | :--- |
| 1 | **D0**/A0 | **D0**/A0 | スピーカー |
| 2 | **D1**/A1 | **D1**/A1 | ロータリーエンコーダー（A相） |
| 3 | **D2**/A2 | **D2**/A2 | ロータリーエンコーダー（B相） |
| 4 | **D3**/A3 | **D3**/A3 | スピーカーENABLE |
| 5 | D4/**SDA** | D4/A4/**SDA** | Grove I2C（SDA） |
| 6 | D5/**SCL** | D5/A5/**SCL** | Grove I2C（SCL） |
| 7 | **D6**/TX | **D6**/TX | LED |
| 8 | **D7**/RX | **D7**/RX | SELECTボタン |
| 9 | D8/**SCK** | D8/**SCK** | LEDドライバ（SCLK） |
| 10 | **D9**/MISO | D9/MISO | ESCAPEボタン |
| 11 | D10/**MOSI** | D10/**MOSI** | LEDドライバ（DIN） |
| 12 | **3V3** | **3V3** |
| 13 | **GND** | **GND** |
| 14 | **5V** | **5V** |

### ES基板

* [回路図](hardware/algyan_8th.es.pdf)

### ES2基板

* [回路図](hardware/algyan_8th.es2.pdf)
